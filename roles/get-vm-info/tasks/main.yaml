- name: Call the API and get JSON response
  uri:
    url: "{{ api_endpoint }}"
    method: GET
    return_content: yes
    status_code: 200
    ssl_verify: no
  register: api_response

- name: Set hostname and ip facts from API response
  set_fact:
    hostname: "{{ (api_response.json).hostname }}"
    ip: "{{ (api_response.json).ip }}"

- name: Display hostname and ip facts
  debug:
    msg:
      - "Hostname: {{ hostname }}"
      - "IP: {{ ip }}"

- name: Set info fact for workflow
  set_stats:
    data:
      assigned_ip: "{{ ip }}"
      assigned_hostname: "{{ hostname }}"